<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    Archive: 2019
  
</title>

<meta property="og:type" content="website">
<meta property="og:title" content="G.O.D的技术博客">
<meta property="og:url" content="http://yoursite.com/archives/2019/index.html">
<meta property="og:site_name" content="G.O.D的技术博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="G.O.D的技术博客">


  <link rel="alternative" href="/atom.xml" title="G.O.D的技术博客" type="application/atom+xml">



  <link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="/perfect-scrollbar/css/perfect-scrollbar.min.css">
<link rel="stylesheet" href="/styles/main.css">






</head>
<body
  
    class="monochrome"
  
  >
  <div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="/">G.O.D的技术博客</a>
</div>

  <div class="main-container">
    <div class="sidebar">
  <div class="header">
    <h1 class="title"><a href="/">G.O.D的技术博客</a></h1>
    
      <p class="subtitle">
        小舟从此逝 代码寄余生
      </p>
    
    <div class="info">
      <div class="content">
        
        
          <div class="author">左博杨</div>
        
      </div>
      
        <div class="avatar">
          
            <a href="/about"><img src="/images/author_avatar.JPG"></a>
          
        </div>
      
    </div>
  </div>
  <div class="body">
    
      
        <ul class="nav">
          
            
              <li class="category-list-container">
                <a href="javascript:;">Category</a>
                
              </li>
            
          
            
              <li class="tag-list-container">
                <a href="javascript:;">Tag</a>
                
              </li>
            
          
            
              <li class="archive-list-container">
                <a href="javascript:;">Archive</a>
                <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a><span class="archive-list-count">7</span></li></ul>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="/" title="Homepage">Homepage</a>
              </li>
            
          
            
              <li>
                <a href="/archives" title="By Year">By Year</a>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="https://github.com/BoYangZuo" title="Github" target="_blank" rel="noopener">Github</a>
              </li>
            
          
            
              <li>
                <a href="https://www.jianshu.com/u/e19c4fb93a90" title="简书" target="_blank" rel="noopener">简书</a>
              </li>
            
          
        </ul>
      
    
  </div>
</div>

    <div class="main-content">
      
        <div style="max-width: 1000px">
      
          

  
  
    
      
      
      <section class="archives-wrap">
        <div class="archive-year-wrap">
          <h1><a href="/archives/2019" class="archive-year">2019</a></h1>
        </div>
        <div class="post-list">
    
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/03/17/如何更好的自定义 UISegmentedControl/" >
  如何更好的自定义 UISegmentedControl
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/03/17/如何更好的自定义 UISegmentedControl/"><span class="article-date">
  2019-03-17
</span>
</a>
        

        

      </div>
      <div class="article-entry">
        
          <p>前几天因为业务需求，随手写了一个类似于 <strong>UISegmentedControl</strong> 的控件，写完后觉得代码没什么毛病，简洁好用，可读性也好，也仅仅只有 200 行代码。后来 <strong>Code Review</strong> 的时候，leader 说了一些观点让我觉得很受用。也让我觉得自定义 <strong>UI</strong> 控件其实需要更多的思考，而不仅仅是功能上面的实现。所以写篇文章记录下来。大致效果如下：</p>
<img src="/2019/03/17/如何更好的自定义%20UISegmentedControl/SegmentedControl.gif" title="SegmentedControl">
<p>因为代码不多，就直接放到文章里了。</p>
<h5 id="类的设计思路："><a href="#类的设计思路：" class="headerlink" title="类的设计思路："></a>类的设计思路：</h5><ol>
<li>View层面：一个 <strong>UIStackView</strong>，一堆 <strong>UILabel</strong>，一个用于滑动的 <strong>sliderview</strong>。<br><strong>UIStackView</strong> 负责管理一堆 <strong>Label</strong> ，<strong>Label</strong> 的背景色均为透明，<strong>sliderView</strong> 作为滑块充当 <strong>Label</strong> 的背景效果。</li>
<li>交互层面：根据 <code>segmentItems</code> 的数量计算出每个 <strong>Label</strong> 的宽度，再通过触摸点算出 <strong>location</strong> 所在的位置的 <strong>Label</strong> 和 <strong>index</strong>，然后更新  <strong>sliderView</strong> 的位置，同时更新 <strong>label</strong> 的文本颜色。</li>
</ol>
<p>看一下我最早提交的版本。</p>
<h5 id="类的声明："><a href="#类的声明：" class="headerlink" title="类的声明："></a>类的声明：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@class OUPCornerSegmentedControl;</span><br><span class="line"></span><br><span class="line">@protocol OUPCornerSegmentedControlDelegate&lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">@optional</span><br><span class="line"></span><br><span class="line">- (void)segmentedControl:(OUPCornerSegmentedControl*)control didSelectedItemAtIndex:(NSUInteger)index;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface OUPCornerSegmentedControl : UIControl</span><br><span class="line"></span><br><span class="line">@property (nonatomic) UIFont* font;</span><br><span class="line">@property (nonatomic) UIColor* normalTextColor;</span><br><span class="line">@property (nonatomic) UIColor* highlightTextColor;</span><br><span class="line">@property (nonatomic) UIColor* sliderColor;</span><br><span class="line">@property (nonatomic) CGFloat margin;</span><br><span class="line"></span><br><span class="line">@property (nonatomic) NSArray&lt;NSString*&gt;* segmentItems;</span><br><span class="line">@property (nonatomic, readonly) NSUInteger selectedSegmentIndex;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, weak) id&lt;OUPCornerSegmentedControlDelegate&gt; delegate;</span><br><span class="line"></span><br><span class="line">- (void)setSelectedSegmentIndex:(NSUInteger)selectedSegmentIndex animated:(BOOL)animated;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h5 id="类的实现："><a href="#类的实现：" class="headerlink" title="类的实现："></a>类的实现：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line">@interface OUPCornerSegmentedControl ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic) UIStackView* stackView;</span><br><span class="line">@property (nonatomic) UIView* slider;</span><br><span class="line">@property (nonatomic) CGFloat segmentWidth;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation OUPCornerSegmentedControl</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithCoder:(NSCoder*)coder</span><br><span class="line">&#123;</span><br><span class="line">    self = [super initWithCoder:coder];</span><br><span class="line">    if (self)</span><br><span class="line">    &#123;</span><br><span class="line">        [self commonInit];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame</span><br><span class="line">&#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self)</span><br><span class="line">    &#123;</span><br><span class="line">        [self commonInit];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)commonInit</span><br><span class="line">&#123;</span><br><span class="line">    _font = [UIFont systemFontOfSize:14];</span><br><span class="line">    _normalTextColor = UIColor.grayColor;</span><br><span class="line">    _highlightTextColor = UIColor.whiteColor;</span><br><span class="line">    _sliderColor = UIColor.darkGrayColor;</span><br><span class="line">    _margin = 2.0;</span><br><span class="line">    _selectedSegmentIndex = 0;</span><br><span class="line"></span><br><span class="line">    _slider = [[UIView alloc] init];</span><br><span class="line">    _slider.backgroundColor = _sliderColor;</span><br><span class="line">    [self addSubview:_slider];</span><br><span class="line"></span><br><span class="line">    _stackView = [[UIStackView alloc] init];</span><br><span class="line">    _stackView.axis = UILayoutConstraintAxisHorizontal;</span><br><span class="line">    _stackView.alignment = UIStackViewAlignmentFill;</span><br><span class="line">    _stackView.distribution = UIStackViewDistributionFillEqually;</span><br><span class="line">    [self addSubview:_stackView];</span><br><span class="line">    [_stackView mas_makeConstraints:^(MASConstraintMaker* make) &#123;</span><br><span class="line">        make.edges.equalTo(self).insets(UIEdgeInsetsMake(_margin, _margin, _margin, _margin));</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    [self addTapGesture];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)layoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line"></span><br><span class="line">    self.segmentWidth = (self.frame.size.width - 2 * self.margin) / self.segmentItems.count;</span><br><span class="line"></span><br><span class="line">    let sliderHeight = self.frame.size.height - 2 * self.margin;</span><br><span class="line">    self.slider.frame = CGRectMake(self.margin + self.selectedSegmentIndex * self.segmentWidth, self.margin, self.segmentWidth, sliderHeight);</span><br><span class="line"></span><br><span class="line">    [self setupCornerRadius];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setupCornerRadius</span><br><span class="line">&#123;</span><br><span class="line">    self.layer.cornerRadius = self.frame.size.height / 2;</span><br><span class="line">    self.slider.layer.cornerRadius = _slider.frame.size.height / 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)insertAllSegments</span><br><span class="line">&#123;</span><br><span class="line">    let labelMaker = ^UILabel*(NSString* title, UIColor* textColor, UIFont* font)</span><br><span class="line">    &#123;</span><br><span class="line">        let label = [[UILabel alloc] init];</span><br><span class="line">        label.text = title;</span><br><span class="line">        label.textColor = textColor;</span><br><span class="line">        label.font = font;</span><br><span class="line">        label.textAlignment = NSTextAlignmentCenter;</span><br><span class="line">        label.backgroundColor = UIColor.clearColor;</span><br><span class="line"></span><br><span class="line">        return label;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; _segmentItems.count; I++)</span><br><span class="line">    &#123;</span><br><span class="line">        let title = _segmentItems[I];</span><br><span class="line">        let label = labelMaker(title, self.normalTextColor, self.font);</span><br><span class="line">        [_stackView addArrangedSubview:label];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)removeAllSegments</span><br><span class="line">&#123;</span><br><span class="line">    for (UIView* v in _stackView.arrangedSubviews)</span><br><span class="line">    &#123;</span><br><span class="line">        [v removeFromSuperview];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _segmentItems = nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)updateLabelsColor</span><br><span class="line">&#123;</span><br><span class="line">    for (UIView* v in _stackView.subviews)</span><br><span class="line">    &#123;</span><br><span class="line">        if ([v isKindOfClass:[UILabel class]])</span><br><span class="line">        &#123;</span><br><span class="line">            UILabel* label = (UILabel*)v;</span><br><span class="line">            label.textColor = self.normalTextColor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    UILabel* label = _stackView.arrangedSubviews[self.selectedSegmentIndex];</span><br><span class="line">    label.textColor = self.highlightTextColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)addTapGesture</span><br><span class="line">&#123;</span><br><span class="line">    UITapGestureRecognizer* tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(handleTapGesture:)];</span><br><span class="line">    [self addGestureRecognizer:tap];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSUInteger)segmentIndexWithLocation:(CGPoint)point</span><br><span class="line">&#123;</span><br><span class="line">    NSUInteger index = (point.x - self.margin) / self.segmentWidth;</span><br><span class="line"></span><br><span class="line">    if (index &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        index = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    if (index &gt; self.segmentItems.count - 1)</span><br><span class="line">    &#123;</span><br><span class="line">        index = self.segmentItems.count - 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return index;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)moveToIndex:(NSUInteger)index animated:(BOOL)animated</span><br><span class="line">&#123;</span><br><span class="line">    let frame = self.slider.frame;</span><br><span class="line">    let x = index * self.segmentWidth + self.margin;</span><br><span class="line"></span><br><span class="line">    let duration = animated ? kUPAnimationDurationShort : 0.0;</span><br><span class="line">    [UIView animateWithDuration:duration</span><br><span class="line">        animations:^&#123;</span><br><span class="line">            self.slider.frame = CGRectMake(x, frame.origin.y, frame.size.width, frame.size.height);</span><br><span class="line">        &#125;</span><br><span class="line">        completion:^(BOOL finished) &#123;</span><br><span class="line">            _selectedSegmentIndex = index;</span><br><span class="line">            [self updateLabelsColor];</span><br><span class="line">        &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - UIGestureRecognizer Actions</span><br><span class="line"></span><br><span class="line">- (void)handleTapGesture:(UITapGestureRecognizer*)tapGR</span><br><span class="line">&#123;</span><br><span class="line">    CGPoint location = [tapGR locationInView:self];</span><br><span class="line">    NSUInteger index = [self segmentIndexWithLocation:location];</span><br><span class="line">    [self moveToIndex:index animated:YES];</span><br><span class="line"></span><br><span class="line">    if ([self.delegate respondsToSelector:@selector(segmentedControl:didSelectedItemAtIndex:)])</span><br><span class="line">    &#123;</span><br><span class="line">        [self.delegate segmentedControl:self didSelectedItemAtIndex:index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - getters &amp;&amp; setters</span><br><span class="line"></span><br><span class="line">- (void)setSliderColor:(UIColor*)sliderColor</span><br><span class="line">&#123;</span><br><span class="line">    _sliderColor = sliderColor;</span><br><span class="line">    _slider.backgroundColor = sliderColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setSelectedSegmentIndex:(NSUInteger)selectedSegmentIndex animated:(BOOL)animated;</span><br><span class="line">&#123;</span><br><span class="line">    _selectedSegmentIndex = selectedSegmentIndex;</span><br><span class="line"></span><br><span class="line">    [self moveToIndex:selectedSegmentIndex animated:animated];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setSegmentItems:(NSArray&lt;NSString*&gt;*)segmentItems</span><br><span class="line">&#123;</span><br><span class="line">    if (_segmentItems)</span><br><span class="line">    &#123;</span><br><span class="line">        [self removeAllSegments];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (segmentItems.count == 0)</span><br><span class="line">    &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _segmentItems = [NSArray arrayWithArray:segmentItems];</span><br><span class="line"></span><br><span class="line">    [self insertAllSegments];</span><br><span class="line">    [self updateLabelsColor];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>现在让我们来看看有什么问题。</p>
<h6 id="实现机制"><a href="#实现机制" class="headerlink" title="实现机制"></a>实现机制</h6><ol>
<li><code>segmentWidth</code> 这个属性真的有存在的必要吗？通过算坐标值来确定点击到的 <strong>UILabel</strong> 当然可行，但是计算性的代码写的再好毕竟也不能一目了然。有没有可读性更好的做法？</li>
<li>既然是 <strong>UIControl</strong> 的子类，是不是有比 <strong>Delegate</strong> 更好的机制来传递事件？</li>
<li>既然重写了<code>selectedSegmentIndex</code> 的 <strong>setter</strong> 函数，为什么还存在使用下划线变量赋值的代码？</li>
</ol>
<h6 id="命名问题"><a href="#命名问题" class="headerlink" title="命名问题"></a>命名问题</h6><ol>
<li><code>Corner</code> 代表的是拐角，并不能描述出圆角的概念</li>
<li><code>highlightTextColor</code> 是高亮字体色，并不能描述出选中字体色的概念</li>
<li><code>margin</code> 代表的是外间距，并不是内间距</li>
</ol>
<p>其实 <strong>margin</strong> 是 <strong>css</strong> 布局中的概念，放张图科普一下<br><img src="/2019/03/17/如何更好的自定义%20UISegmentedControl/1.png"></p>
<ol start="4">
<li><code>slider</code> 是滑动的意思，如果你将一个对象命名为 <code>sliderView</code>。那么至少这个类可以支持拖动，类似于 <strong>UISlider</strong> 的效果。</li>
<li><code>- (void)moveToIndex:(NSUInteger)index animated:(BOOL)animated</code> 是不是说清楚 move 什么 to index 比较好？</li>
</ol>
<h6 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h6><ol>
<li><code>- (void)moveToIndex:(NSUInteger)index animated:(BOOL)animated</code> 的实现中为什么会调用 <code>updateLabelsColor</code> 和更新 <code>_selectedSegmentIndex</code> 的值？简简单单的 move 接口应该做这么多事么？</li>
<li>声明的可读属性并没有全部重写 <strong>setter</strong> 函数 。不能默认调用者知道先传入 <code>segmentItems</code> 再设置其他属性才能生效。</li>
</ol>
<p>当时一下子抛出这么多问题，我有点哑口无言，本来想着一个只有200行代码的类，使用一些 <strong>frame</strong> 不是很方便么？<strong>Delegate</strong> 也很好用。然后仔细想了想，这些问题确实很有道理。不知道读到这里，你们的想法是什么？</p>
<p>现在我们来看一下修改之后的代码</p>
<p>修改后的代码：</p>
<h5 id="命名问题-1"><a href="#命名问题-1" class="headerlink" title="命名问题"></a>命名问题</h5><ol>
<li>Renamed <code>CornerSegmentedControl</code> -&gt; <code>RoundCornerSegmentedControl</code></li>
<li>Renamed <code>highlightTextColor</code> -&gt; <code>selectedTextColor</code> </li>
<li>Renamed <code>margin</code> -&gt; <code>padding</code></li>
<li>Renamed <code>slider</code> -&gt; <code>indicator</code></li>
<li>Renamed <code>- (void)moveToIndex:(NSUInteger)index animated:(BOOL)animated</code> -&gt; <code>- (void)moveIndicatorToSegmentAtIndex:(NSInteger)index animated:(BOOL)animated</code></li>
</ol>
<h5 id="实现机制-1"><a href="#实现机制-1" class="headerlink" title="实现机制"></a>实现机制</h5><ol>
<li>去掉了<code>segmentWidth</code> 属性。既然已经用了 <strong>UIStackView</strong> 来管理视图，那么通过 <strong>UIStackView + AutoLayout</strong> 完全可以省去坐标计算的问题 。当用户点击的时候，遍历所有的 <code>label</code> ，判断坐标点在哪一个 <code>label</code> 上，然后更新 <code>indicatorView</code>的布局和 label 的字体颜色。</li>
<li>使用 <strong>Target-Action</strong> 机制。在恰当的时机调用<br><code>- (void)sendActionsForControlEvents:(UIControlEvents)controlEvents</code><br>来触发 <strong>action</strong>。这样既和系统的行为保持一致，对于调用方而言，成本也会小很多。</li>
</ol>
<img src="/2019/03/17/如何更好的自定义%20UISegmentedControl/2.png">
<h5 id="接口设计-1"><a href="#接口设计-1" class="headerlink" title="接口设计"></a>接口设计</h5><p>将 <code>- (void)updateLabelsColorAnimated:(BOOL)animated</code> 和 <code>_selectedSegmentIndex = index;</code>从 <code>- (void)moveIndicatorToSegmentAtIndex:(NSInteger)index animated:(BOOL)animated</code> 中拿出来，保证了接口的单一原则：move 应该只做和视图移动有关的事情，它不应该去更新文本颜色，也不应该去更新当前选中的索引值。</p>
<h5 id="类的声明"><a href="#类的声明" class="headerlink" title="类的声明"></a>类的声明</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@interface OUPRoundCornerSegmentedControl : UIControl</span><br><span class="line"></span><br><span class="line">@property (nonatomic) UIFont* font;  // default [UIFont systemFontOfSize:14]</span><br><span class="line">@property (nonatomic) UIColor* normalTextColor;    // default UIColor.grayColor</span><br><span class="line">@property (nonatomic) UIColor* selectedTextColor;  // default UIColor.whiteColor</span><br><span class="line">@property (nonatomic) UIColor* indicatorColor;     // default UIColor.darkGrayColor</span><br><span class="line">@property (nonatomic) CGFloat edgeInset;  // default 2.0</span><br><span class="line"></span><br><span class="line">@property (nonatomic) NSArray&lt;NSString*&gt;* segmentItems;</span><br><span class="line">@property (nonatomic) NSInteger selectedSegmentIndex;  // default 0</span><br><span class="line"></span><br><span class="line">- (void)setSelectedSegmentIndex:(NSInteger)selectedSegmentIndex animated:(BOOL)animated;</span><br><span class="line">- (void)setNormalTextColor:(UIColor*)normalTextColor animated:(BOOL)animated;</span><br><span class="line">- (void)setSelectedTextColor:(UIColor*)selectedTextColor animated:(BOOL)animated;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h5 id="类的实现"><a href="#类的实现" class="headerlink" title="类的实现"></a>类的实现</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><span class="line">@interface OUPRoundCornerSegmentedControl ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic) UIStackView* stackView;</span><br><span class="line">@property (nonatomic) UIView* indicatorView;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation OUPRoundCornerSegmentedControl</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithCoder:(NSCoder*)coder</span><br><span class="line">&#123;</span><br><span class="line">    self = [super initWithCoder:coder];</span><br><span class="line">    if (self)</span><br><span class="line">    &#123;</span><br><span class="line">        [self commonInit];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame</span><br><span class="line">&#123;</span><br><span class="line">    self = [super initWithFrame:frame];</span><br><span class="line">    if (self)</span><br><span class="line">    &#123;</span><br><span class="line">        [self commonInit];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)commonInit</span><br><span class="line">&#123;</span><br><span class="line">    _font = [UIFont systemFontOfSize:14];</span><br><span class="line">    _normalTextColor = UIColor.grayColor;</span><br><span class="line">    _selectedTextColor = UIColor.whiteColor;</span><br><span class="line">    _indicatorColor = UIColor.darkGrayColor;</span><br><span class="line">    _edgeInset = 2.0;</span><br><span class="line">    _selectedSegmentIndex = 0;</span><br><span class="line"></span><br><span class="line">    _indicatorView = [[UIView alloc] init];</span><br><span class="line">    _indicatorView.backgroundColor = _indicatorColor;</span><br><span class="line">    _indicatorView.userInteractionEnabled = NO;</span><br><span class="line">    [self addSubview:_indicatorView];</span><br><span class="line"></span><br><span class="line">    _stackView = [[UIStackView alloc] init];</span><br><span class="line">    _stackView.axis = UILayoutConstraintAxisHorizontal;</span><br><span class="line">    _stackView.alignment = UIStackViewAlignmentFill;</span><br><span class="line">    _stackView.distribution = UIStackViewDistributionFillEqually;</span><br><span class="line">    _stackView.userInteractionEnabled = NO;</span><br><span class="line">    [self addSubview:_stackView];</span><br><span class="line"></span><br><span class="line">    [_stackView mas_makeConstraints:^(MASConstraintMaker* make) &#123;</span><br><span class="line">        make.edges.equalTo(self).insets(UIEdgeInsetsMake(_edgeInset, _edgeInset, _edgeInset, _edgeInset));</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)layoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line"></span><br><span class="line">    self.layer.cornerRadius = self.frame.size.height / 2;</span><br><span class="line">    _indicatorView.layer.cornerRadius = _indicatorView.frame.size.height / 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)insertAllSegments</span><br><span class="line">&#123;</span><br><span class="line">    let labelMaker = ^UILabel*(NSString* title, UIColor* textColor, UIFont* font)</span><br><span class="line">    &#123;</span><br><span class="line">        let label = [[UILabel alloc] init];</span><br><span class="line">        label.userInteractionEnabled = NO;</span><br><span class="line">        label.text = title;</span><br><span class="line">        label.textColor = textColor;</span><br><span class="line">        label.font = font;</span><br><span class="line">        label.textAlignment = NSTextAlignmentCenter;</span><br><span class="line">        label.backgroundColor = UIColor.clearColor;</span><br><span class="line"></span><br><span class="line">        return label;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    foreach (title, _segmentItems)</span><br><span class="line">    &#123;</span><br><span class="line">        let label = labelMaker(title, _normalTextColor, _font);</span><br><span class="line">        [_stackView addArrangedSubview:label];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)removeAllSegments</span><br><span class="line">&#123;</span><br><span class="line">    foreach (segment, _stackView.arrangedSubviews)</span><br><span class="line">    &#123;</span><br><span class="line">        [segment removeFromSuperview];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _segmentItems = nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)updateLabelsColorAnimated:(BOOL)animated</span><br><span class="line">&#123;</span><br><span class="line">    UILabel* selectedLabel = nil;</span><br><span class="line">    if (_selectedSegmentIndex &gt;= 0 &amp;&amp; _selectedSegmentIndex &lt; _stackView.arrangedSubviews.count)</span><br><span class="line">    &#123;</span><br><span class="line">        selectedLabel = _stackView.arrangedSubviews[_selectedSegmentIndex];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let duration = animated ? kUPAnimationDurationShort : 0.0;</span><br><span class="line"></span><br><span class="line">    [UIView animateWithDuration:duration</span><br><span class="line">                     animations:^&#123;</span><br><span class="line">                         foreach (segment, _stackView.arrangedSubviews)</span><br><span class="line">                         &#123;</span><br><span class="line">                             let label = SC_STATIC_CAST(segment, UILabel);</span><br><span class="line">                             let isSelected = label == selectedLabel;</span><br><span class="line">                             label.textColor = isSelected ? _selectedTextColor : _normalTextColor;</span><br><span class="line">                         &#125;</span><br><span class="line">                     &#125;</span><br><span class="line">                     completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSUInteger)segmentIndexAtPoint:(CGPoint)point</span><br><span class="line">&#123;</span><br><span class="line">    for (int i = 0; i &lt; _stackView.arrangedSubviews.count; I++)</span><br><span class="line">    &#123;</span><br><span class="line">        let segment = _stackView.arrangedSubviews[I];</span><br><span class="line">        let frame = segment.frame;</span><br><span class="line">        let containsPoint = point.x &gt;= CGRectGetMinX(frame) &amp;&amp; point.x &lt;= CGRectGetMaxX(frame);</span><br><span class="line">        if (containsPoint)</span><br><span class="line">        &#123;</span><br><span class="line">            return I;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (point.x &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        return _segmentItems.count - 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)moveIndicatorToSegmentAtIndex:(NSInteger)index animated:(BOOL)animated</span><br><span class="line">&#123;</span><br><span class="line">    if (index == UISegmentedControlNoSegment)</span><br><span class="line">    &#123;</span><br><span class="line">        SCNotImplementedAssert();</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    let selectedSegment = _stackView.arrangedSubviews[index];</span><br><span class="line">    let duration = animated ? kUPAnimationDurationShort : 0.0;</span><br><span class="line"></span><br><span class="line">    [UIView animateWithDuration:duration</span><br><span class="line">                     animations:^&#123;</span><br><span class="line">                         [_indicatorView mas_remakeConstraints:^(MASConstraintMaker* make) &#123;</span><br><span class="line">                             make.edges.equalTo(selectedSegment);</span><br><span class="line">                         &#125;];</span><br><span class="line"></span><br><span class="line">                         [self layoutIfNeeded];</span><br><span class="line">                     &#125;</span><br><span class="line">                     completion:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Touch</span><br><span class="line"></span><br><span class="line">- (void)endTrackingWithTouch:(UITouch*)touch withEvent:(UIEvent*)event</span><br><span class="line">&#123;</span><br><span class="line">    let location = [touch locationInView:self];</span><br><span class="line">    let index = [self segmentIndexAtPoint:location];</span><br><span class="line"></span><br><span class="line">    if (index != _selectedSegmentIndex)</span><br><span class="line">    &#123;</span><br><span class="line">        [self setSelectedSegmentIndex:index animated:YES];</span><br><span class="line">        [self sendActionsForControlEvents:UIControlEventValueChanged];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [super endTrackingWithTouch:touch withEvent:event];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - getters &amp;&amp; setters</span><br><span class="line"></span><br><span class="line">- (void)setFont:(UIFont*)font</span><br><span class="line">&#123;</span><br><span class="line">    _font = font;</span><br><span class="line"></span><br><span class="line">    foreach (segment, _stackView.arrangedSubviews)</span><br><span class="line">    &#123;</span><br><span class="line">        SC_STATIC_CAST(segment, UILabel).font = font;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setNormalTextColor:(UIColor*)normalTextColor</span><br><span class="line">&#123;</span><br><span class="line">    [self setNormalTextColor:normalTextColor animated:NO];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setNormalTextColor:(UIColor*)normalTextColor animated:(BOOL)animated</span><br><span class="line">&#123;</span><br><span class="line">    _normalTextColor = normalTextColor;</span><br><span class="line"></span><br><span class="line">    [self updateLabelsColorAnimated:animated];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setSelectedTextColor:(UIColor*)selectedTextColor</span><br><span class="line">&#123;</span><br><span class="line">    [self setSelectedTextColor:selectedTextColor animated:NO];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setSelectedTextColor:(UIColor*)selectedTextColor animated:(BOOL)animated</span><br><span class="line">&#123;</span><br><span class="line">    _selectedTextColor = selectedTextColor;</span><br><span class="line"></span><br><span class="line">    [self updateLabelsColorAnimated:animated];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setIndicatorColor:(UIColor*)indicatorColor</span><br><span class="line">&#123;</span><br><span class="line">    _indicatorColor = indicatorColor;</span><br><span class="line">    _indicatorView.backgroundColor = indicatorColor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setEdgeInset:(CGFloat)edgeInset</span><br><span class="line">&#123;</span><br><span class="line">    _edgeInset = edgeInset;</span><br><span class="line"></span><br><span class="line">    [_stackView mas_remakeConstraints:^(MASConstraintMaker* make) &#123;</span><br><span class="line">        make.edges.equalTo(self).insets(UIEdgeInsetsMake(_edgeInset, _edgeInset, _edgeInset, _edgeInset));</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setSelectedSegmentIndex:(NSInteger)selectedSegmentIndex</span><br><span class="line">&#123;</span><br><span class="line">    [self setSelectedSegmentIndex:selectedSegmentIndex animated:NO];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setSelectedSegmentIndex:(NSInteger)selectedSegmentIndex animated:(BOOL)animated;</span><br><span class="line">&#123;</span><br><span class="line">    if (selectedSegmentIndex == UISegmentedControlNoSegment)</span><br><span class="line">    &#123;</span><br><span class="line">        SCNotImplementedAssert();</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (selectedSegmentIndex &lt; UISegmentedControlNoSegment || selectedSegmentIndex &gt;= _segmentItems.count)</span><br><span class="line">    &#123;</span><br><span class="line">        SCParameterAssert(selectedSegmentIndex &gt; UISegmentedControlNoSegment &amp;&amp; selectedSegmentIndex &lt; _segmentItems.count);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _selectedSegmentIndex = selectedSegmentIndex;</span><br><span class="line"></span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        [self updateLabelsColorAnimated:animated];</span><br><span class="line">        [self moveIndicatorToSegmentAtIndex:selectedSegmentIndex animated:animated];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setSegmentItems:(NSArray&lt;NSString*&gt;*)segmentItems</span><br><span class="line">&#123;</span><br><span class="line">    if (_segmentItems)</span><br><span class="line">    &#123;</span><br><span class="line">        [self removeAllSegments];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    NSInteger selectedSegmentIndex = _selectedSegmentIndex;</span><br><span class="line"></span><br><span class="line">    if (_selectedSegmentIndex &gt;= segmentItems.count)</span><br><span class="line">    &#123;</span><br><span class="line">        selectedSegmentIndex = UISegmentedControlNoSegment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (segmentItems.count == 0)</span><br><span class="line">    &#123;</span><br><span class="line">        SCNotImplementedAssert();</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _segmentItems = [NSArray arrayWithArray:segmentItems];</span><br><span class="line"></span><br><span class="line">    [self insertAllSegments];</span><br><span class="line"></span><br><span class="line">    [self setSelectedSegmentIndex:selectedSegmentIndex animated:NO];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>改完之后的代码的可读性明显比之前要好很多，无论从接口设计，还是命名上都比之前要规范<br>（虽然我觉得之前的代码可读性也不差哈哈）。</p>
<p>其实目前的代码看起来还有一些扩展性问题。不过因为业务目前并不需要，我就没有再调整代码了。这里说一下问题，有兴趣的朋友可以自己实现一下。<br>因为现在仅仅支持两种文本颜色，选中和未选中。如果日后需要支持更多的文本颜色，肯定需要增加一些额外的参数，变量和接口来维护不同的样式。</p>
<p>考虑到整个类是继承自 <strong>UIControl</strong> ，所以对于字体颜色的设置如果改成和 <strong>UIButton</strong> 相同的行为就会简单很多：</p>
<p><code>- (void)setTextColor:(UIColor*)color forState:(UIControlState)state</code></p>
<p>日后如果需要支持图片，那么接口设计和内部实现也会变得非常简单</p>
<p><code>- (void)setImage:(UIColor*)color forState:(UIControlState)state</code><br><code>- (void)setImage:(UIColor*)color forState:(UIControlState)state atIndex:(NSInteger)index</code></p>
<p>所以，如果你要设计一个继承自 <strong>UIControl</strong> 的类，那么应该注意以下几点：</p>
<ol>
<li>使用 <code>Target-Action</code> 机制</li>
<li>善用 <code>UIControlState</code> 来管理 <strong>UI</strong> 的行为</li>
</ol>
<p>脱离 <strong>UIControl</strong> 的设计原则，来讲讲一些其他基本的注意点：</p>
<ol>
<li>如果你重新实现了一个属性的 <strong>setter</strong> 函数，那么务必确保该变量的值只会在其 <strong>setter</strong> 函数中更改，在其他接口中你不应该直接使用点语法赋值，应该通过调用 <strong>setter</strong> 函数来赋值。</li>
<li>苹果为我们提供了很好的 <strong>AutoLayout</strong> 机制，应当好好使用，并且 <strong>WWCD2018</strong> 上也提到了 <strong>AutoLayout</strong> 性能会得到本质性的改善。重复计算 <strong>frame</strong> 这种事情除非必要，比如设置 <strong>layer</strong> 的圆角等，应该学会尽量用 <strong>AutoLayout</strong> 去解决问题。</li>
</ol>

        
      </div>
    </div>

  






          <div class="main-footer">
  
    © 2019 G.O.D的技术博客 - Powered by <a href="http://hexo.io" target="_blank">Hexo</a> - Theme <a href="https://github.com/denjones/hexo-theme-chan" target="_blank">Chan</a>
  
</div>

      
        </div>
      
    </div>
  </div>
  <script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>


<script src="/perfect-scrollbar/js/min/perfect-scrollbar.min.js"></script>
<script src="/scripts/main.js"></script>

</body>
</html>
